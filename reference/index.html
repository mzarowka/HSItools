<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Function reference • HSItools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Function reference"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">HSItools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9008</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/shiny_gui.html">Graphical user interface with Shiny</a>
    <a class="dropdown-item" href="../articles/workflow.html">Basic workflow</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mzarowka/HSItools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-index">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Function reference</h1>
    </div>

    <div class="section level2">
      <h2 id="all-functions">All functions<a class="anchor" aria-label="anchor" href="#all-functions"></a></h2>
      
      

      
    </div><div id="" class="section level2">
      
      
      

      <dl><dt>
          
          <code><a href="calculate_band_difference.html">calculate_band_difference()</a></code> 
        </dt>
        <dd>Calculate band difference</dd>
      </dl><dl><dt>
          
          <code><a href="calculate_band_ratio.html">calculate_band_ratio()</a></code> 
        </dt>
        <dd>Calculate band ratio</dd>
      </dl><dl><dt>
          
          <code><a href="calculate_derivative.html">calculate_derivative()</a></code> 
        </dt>
        <dd>Calculate derivative</dd>
      </dl><dl><dt>
          
          <code><a href="calculate_lambdaremp.html">calculate_lambdaremp()</a></code> 
        </dt>
        <dd>Calculate lambdaREMP</dd>
      </dl><dl><dt>
          
          <code><a href="calculate_raba.html">calculate_raba()</a></code> 
        </dt>
        <dd>Calculate Relative Absorption Band Area (RABA)</dd>
      </dl><dl><dt>
          
          <code><a href="calculate_rabd.html">calculate_rabd()</a></code> 
        </dt>
        <dd>Calculate Relative Absorption Band Depth (RABD)</dd>
      </dl><dl><dt>
          
          <code><a href="calculate_rmean.html">calculate_rmean()</a></code> 
        </dt>
        <dd>Calculate Rmean</dd>
      </dl><dl><dt>
          
          <code><a href="change_output_dir.html">change_output_dir()</a></code> 
        </dt>
        <dd>Adjust paths from Shiny output</dd>
      </dl><dl><dt>
          
          <code><a href="create_normalized_raster.html">create_normalized_raster()</a></code> 
        </dt>
        <dd>Raster normalization</dd>
      </dl><dl><dt>
          
          <code><a href="create_reference_raster.html">create_reference_raster</a></code> 
        </dt>
        <dd>#' Create reference SpatRaster
#'
#' @param raster terra SpatRaster of the captured reference.
#' @param roi Region Of Interest: extent to match data raster.
#' @param ref_type type of reference, one of "whiteref" or "darkref".
#' @param ... additional arguments.
#'
#' @return a terra SpatRaster of reference matching the data raster extent.
#' @export
#'
#' @description Creating reference SpatRaster covering core extent
#' Create one mean reference row SpatRaster by averaging data every column by aggregation
#' Create reference SpatRaster matching capture SpatRaster extent by disaggregation.
create_reference_raster_disagg &lt;- function(raster, roi, ref_type, ...) Store additional parameters

params &lt;- rlang::list2(...)

create_reference_raster(raster, roi, ref_type, ...)


rasterterra SpatRaster of the captured reference.

roiRegion Of Interest: extent to match data raster.

ref_typetype of reference, one of "whiteref" or "darkref".

...additional arguments.


a terra SpatRaster of reference matching the data raster extent.


Creating reference SpatRaster covering core extent
Create one mean reference row SpatRaster by averaging data every column by aggregation
Create reference SpatRaster matching capture SpatRaster extent by disaggregation.

Check if correct class is supplied.
if (!inherits(raster, what = "SpatRaster")) 
rlang::abort(message = "Supplied data is not a terra SpatRaster.")



Check number of rois and prepare ids.
if (length(roi) == 1) 
roi_id &lt;- NULL
 else 
roi_id &lt;- paste0("ROI_", seq(1:length(roi)))


if (ref_type == "whiteref") 
name &lt;- "WHITEREF"

 else 
name &lt;- "DARKREF"



Aggregate data into one row SpatRaster, divide by number of rows
cli::cli_alert("Aggregate  name ")

raster &lt;- terra::aggregate(
raster,
fact = c(terra::nrow(raster), 1),
fun = "mean",
overwrite = TRUE,
steps = terra::ncell(raster) * terra::nlyr(raster))


Set new extent to match extent of capture SpatRaster
terra::ext(raster) &lt;- roi


Disaggregate data over entire extent to match capture SpatRaster extent, multiply by ymax
cli::cli_alert("Disaggregate  name ")

raster &lt;- terra::disagg(
raster,
fact = c(terra::ymax(raster), 1),
filename = paste0(params$path, "/products/", name, "_", basename(params$path), "_disaggregated.tif"),
overwrite = TRUE,
steps = terra::ncell(raster) * terra::nlyr(raster))


Return raster</dd>
      </dl><dl><dt>
          
          <code><a href="defineRGB.html">defineRGB()</a></code> 
        </dt>
        <dd>Choose the layers to use for plotting red, green, and blue</dd>
      </dl><dl><dt>
          
          <code><a href="extract_spectral_indices.html">extract_spectral_indices()</a></code> 
        </dt>
        <dd>Extract spectral indices</dd>
      </dl><dl><dt>
          
          <code><a href="extract_spectral_profile.html">extract_spectral_profile()</a></code> 
        </dt>
        <dd>Extract spectral profile from the ROI</dd>
      </dl><dl><dt>
          
          <code><a href="extract_spectral_series.html">extract_spectral_series()</a></code> 
        </dt>
        <dd>Extract average proxy series from ROI</dd>
      </dl><dl><dt>
          
          <code><a href="filter_median.html">filter_median()</a></code> 
        </dt>
        <dd>Smooth raster with focal median</dd>
      </dl><dl><dt>
          
          <code><a href="filter_savgol.html">filter_savgol()</a></code> 
        </dt>
        <dd>Apply a Savitzky-Golay smoothing filter</dd>
      </dl><dl><dt>
          
          <code><a href="get_reflectance.html">get_reflectance</a></code> 
        </dt>
        <dd>#' Prepare core based on shiny output
#'
#' @param core shiny output.
#' @param path path to the directory with captured data. Defaults to NULL and shiny output.
#' @param layers numeric vector, selection of layers (wavelengths) to use. Defaults to NULL and shiny output.
#' @param extent extent of the captured data. Defaults to NULL and shiny output. If "capture" then uses entire extent of captured data.
#' @param normalize logical, should data be normalized.
#' @param integration logical, wether references were scanned with different settings.
#'
#' @return reflectance SpatRaster.
#' @export
prepare_core_disagg &lt;- function(core = NULL, path = NULL, layers = NULL, extent = NULL, normalize = TRUE, integration = NULL) 
if (!is.null(core) == TRUE) 
# Get path
path &lt;- core$directory

get_reflectance(
  core = NULL,
  path = NULL,
  layers = NULL,
  extent = NULL,
  normalize = TRUE,
  integration = NULL,
  roi = FALSE
)


<div class="sourceCode"><pre><code># Get layers
layers &lt;- core$layers
</code></pre></div>

Create products directory and store path



If no rois are selected create only products
products &lt;- fs::dir_create(paste0(path, "/products"))


Check if file needs to be normalized from .raw
if (normalize == TRUE) 
# List files: CAPTURE, DARKREF and WHITEREF
# files &lt;- fs::path_filter(files, regexp = ".raw")

<div class="sourceCode"><pre><code># SpatRaster types
types &lt;- list(capture = "capture", darkref = "darkref", whiteref = "whiteref")

if (is.character(extent) == TRUE) {
  if (extent == "capture"){
  extent &lt;- terra::rast(files[["capture"]]) |&gt;
    terra::ext()
  }
} else if (is.null(extent) == TRUE) {
  extent &lt;- core$cropImage
} else if (inherits(extent, what = "SpatExtent") == TRUE) {
    extent &lt;- terra::ext(extent)
}
# if (is.null(extent) == TRUE) {
#   # Get path
#   extent &lt;- core$cropImage
# } else if (extent == "capture") {
#   extent &lt;- terra::rast(files[["capture"]]) |&gt;
#     terra::ext()
# } else if (!is.null(extent) == TRUE) {
#   extent &lt;- terra::ext(roi)
# }
</code></pre></div>

big_roi &lt;- terra::ext(extent)

<div class="sourceCode"><pre><code>cli::cli_alert_info("{format(Sys.time())}: reading rasters.")

# Get paths separated
# files_path &lt;-

# Print for user to check
cli::cli_inform("Proceeding with the following \"CAPTURE\", \"DARK reference\", and \"WHITE reference\"")
cli::cli_li(files)

# Read SpatRasters
rasters &lt;- files |&gt;
  # Load SpatRasters
  purrr::map(\(x) terra::rast(x))

# Get band positions - the same for all three SpatRasters
band_position &lt;- HSItools::spectra_position(rasters[["capture"]], layers)

cli::cli_alert_info("{format(Sys.time())}: subsetting layers.")

# Subset bands in the SpatRasters
rasters_subset &lt;- rasters |&gt;
  purrr::map(\(x) HSItools::spectra_sub(
    raster = x,
    spectra_tbl = band_position))

cli::cli_alert_info("{format(Sys.time())}: cropping rasters.")

# Crop
rasters_cropped &lt;- purrr::map2(
  rasters_subset,
  types,
  \(x, y) HSItools::raster_crop(
    raster = x,
    type = y,
    roi = big_roi))

cli::cli_alert_info("{format(Sys.time())}: calculating reference rasters.")

# Prepare reference SpatRasters
rasters_references &lt;- purrr::map2(
  rasters_cropped[c("darkref", "whiteref")],
  types[c("darkref", "whiteref")],
  \(x, y) HSItools::create_reference_raster(
    raster = x,
    ref_type = y,
    roi = big_roi,
    path = path))

cli::cli_alert_info("{format(Sys.time())}: calculating reflectance raster.")

# Normalize data
reflectance &lt;- HSItools::create_normalized_raster(
  capture = rasters_cropped[["capture"]],
  whiteref = rasters_references[["whiteref"]],
  darkref = rasters_references[["darkref"]],
  fun = normalization,
  path = path)

cli::cli_alert_info("{format(Sys.time())}: cleaning up.")

# Remove temporary disaggregated files
fs::dir_ls(products, regexp = "disaggregated|cropped") |&gt;
  fs::file_delete()

cli::cli_alert_success("{format(Sys.time())}: finished.")
</code></pre></div>

 else 
reflectance &lt;- fs::path_filter(files, regexp = "REFLECTANCE")



Return reflectance</dd>
      </dl><dl><dt>
          
          <code><a href="normalization.html">normalization()</a></code> 
        </dt>
        <dd>Raster normalization: calculation</dd>
      </dl><dl><dt>
          
          <code><a href="pixel_to_distance.html">pixel_to_distance()</a></code> 
        </dt>
        <dd>Get depth in metric units</dd>
      </dl><dl><dt>
          
          <code><a href="plot_composite.html">plot_composite()</a></code> 
        </dt>
        <dd>Composite hyperspectral indices plots
Can composite line profiles and SpatRasters</dd>
      </dl><dl><dt>
          
          <code><a href="plot_profile_spectral_profile.html">plot_profile_spectral_profile()</a></code> 
        </dt>
        <dd>Line plot of spectral profile from the ROI</dd>
      </dl><dl><dt>
          
          <code><a href="plot_profile_spectral_series.html">plot_profile_spectral_series()</a></code> 
        </dt>
        <dd>Line plots of calculated proxies series</dd>
      </dl><dl><dt>
          
          <code><a href="plot_raster_overlay.html">plot_raster_overlay()</a></code> 
        </dt>
        <dd>Overlay color plot of proxy on RGB</dd>
      </dl><dl><dt>
          
          <code><a href="plot_raster_proxy.html">plot_raster_proxy()</a></code> 
        </dt>
        <dd>Plot spatial map plots of calculated proxies, and optionally save to file</dd>
      </dl><dl><dt>
          
          <code><a href="plot_raster_rgb.html">plot_raster_rgb()</a></code> 
        </dt>
        <dd>Spatial map plots of RGB image</dd>
      </dl><dl><dt>
          
          <code><a href="prepare_core.html">prepare_core()</a></code> 
        </dt>
        <dd>Prepare core based on shiny output</dd>
      </dl><dl><dt>
          
          <code><a href="proxies.html">proxies</a></code> 
        </dt>
        <dd>Preset proxies settings</dd>
      </dl><dl><dt>
          
          <code><a href="raster_crop.html">raster_crop()</a></code> 
        </dt>
        <dd>Crop SpatRaster</dd>
      </dl><dl><dt>
          
          <code><a href="remove_continuum.html">remove_continuum()</a></code> 
        </dt>
        <dd>Remove continuum from spectrum</dd>
      </dl><dl><dt>
          
          <code><a href="roi_to_vect.html">roi_to_vect()</a></code> 
        </dt>
        <dd>Create SpatVector from Shiny ROIs</dd>
      </dl><dl><dt>
          
          <code><a href="run_core.html">run_core()</a></code> 
        </dt>
        <dd>Run shiny app to set up core image analysis parameters</dd>
      </dl><dl><dt>
          
          <code><a href="spectra_position.html">spectra_position()</a></code> 
        </dt>
        <dd>Find position of selected spectra</dd>
      </dl><dl><dt>
          
          <code><a href="spectra_sub.html">spectra_sub()</a></code> 
        </dt>
        <dd>Subset SpatRaster by spectra</dd>
      </dl><dl><dt>
          
          <code><a href="stretch_raster_full.html">stretch_raster_full()</a></code> 
        </dt>
        <dd>Stretch and optionally save full RGB preview of SpatRaster</dd>
      </dl></div>
  </main></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Maurycy Żarczyński, Nicholas McKay, David Edge.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

